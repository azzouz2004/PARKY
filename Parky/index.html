<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ParkOS — Parking Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@300;400;600;700&family=Barlow+Condensed:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c0f;
    --surface: #111418;
    --surface2: #1a1f26;
    --border: #252c36;
    --accent: #f5a623;
    --accent2: #e8320a;
    --green: #2dcc70;
    --red: #e8320a;
    --yellow: #f5a623;
    --blue: #3a9fd8;
    --text: #e8eaed;
    --muted: #5a6370;
    --font-display: 'Bebas Neue', sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
    --font-ui: 'Barlow Condensed', sans-serif;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: var(--font-ui); min-height: 100vh; display: flex; overflow-x: hidden; }
  body::before { content:''; position:fixed; top:0; left:0; width:100%; height:100%; background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.03) 2px,rgba(0,0,0,0.03) 4px); pointer-events:none; z-index:9999; }

  /* ─── SIDEBAR ─── */
  .sidebar { width:220px; background:var(--surface); border-right:1px solid var(--border); display:flex; flex-direction:column; position:fixed; height:100vh; z-index:100; }
  .logo { padding:28px 24px 20px; border-bottom:1px solid var(--border); }
  .logo-title { font-family:var(--font-display); font-size:36px; color:var(--accent); letter-spacing:3px; line-height:1; }
  .logo-sub { font-family:var(--font-mono); font-size:9px; color:var(--muted); letter-spacing:2px; margin-top:4px; text-transform:uppercase; }
  .nav { flex:1; padding:16px 0; overflow-y:auto; }
  .nav-group-label { font-family:var(--font-mono); font-size:9px; color:var(--muted); letter-spacing:3px; text-transform:uppercase; padding:12px 24px 4px; opacity:0.6; }
  .nav-item { display:flex; align-items:center; gap:12px; padding:13px 24px; cursor:pointer; border-left:3px solid transparent; transition:all 0.2s; font-size:15px; font-weight:600; letter-spacing:1px; text-transform:uppercase; color:var(--muted); }
  .nav-item:hover { color:var(--text); background:var(--surface2); border-left-color:var(--border); }
  .nav-item.active { color:var(--accent); background:rgba(245,166,35,0.07); border-left-color:var(--accent); }
  .nav-icon { font-size:16px; width:20px; text-align:center; }
  .sidebar-status { padding:16px 24px; border-top:1px solid var(--border); }
  .status-dot { display:inline-block; width:7px; height:7px; background:var(--green); border-radius:50%; margin-right:8px; animation:pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
  .status-text { font-family:var(--font-mono); font-size:10px; color:var(--muted); letter-spacing:1px; }

  /* ─── MAIN ─── */
  .main { margin-left:220px; flex:1; min-height:100vh; display:flex; flex-direction:column; }
  .topbar { padding:18px 32px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; background:var(--surface); position:sticky; top:0; z-index:50; }
  .page-title { font-family:var(--font-display); font-size:28px; letter-spacing:2px; color:var(--text); }
  .topbar-right { display:flex; align-items:center; gap:16px; font-family:var(--font-mono); font-size:11px; color:var(--muted); }
  .live-badge { display:flex; align-items:center; gap:6px; background:rgba(45,204,112,0.1); border:1px solid rgba(45,204,112,0.3); color:var(--green); padding:4px 12px; border-radius:2px; font-size:10px; letter-spacing:2px; font-weight:700; }
  .content { padding:32px; flex:1; }

  /* ─── PAGE ─── */
  .page { display:none; animation:fadeIn 0.3s ease; }
  .page.active { display:block; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

  /* ─── KPI CARDS ─── */
  .kpi-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:28px; }
  .kpi-card { background:var(--surface); border:1px solid var(--border); padding:24px; position:relative; overflow:hidden; transition:border-color 0.2s; }
  .kpi-card::before { content:''; position:absolute; top:0; left:0; width:3px; height:100%; }
  .kpi-card.total::before{background:var(--blue)} .kpi-card.free::before{background:var(--green)} .kpi-card.occupied::before{background:var(--red)} .kpi-card.bookings::before{background:var(--accent)}
  .kpi-card.rev::before{background:var(--green)} .kpi-card.avg::before{background:var(--blue)} .kpi-card.peak::before{background:var(--accent)} .kpi-card.cancel::before{background:var(--red)}
  .kpi-card:hover { border-color:var(--muted); }
  .kpi-label { font-family:var(--font-mono); font-size:10px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:12px; }
  .kpi-value { font-family:var(--font-display); font-size:52px; line-height:1; letter-spacing:2px; }
  .kpi-card.total .kpi-value{color:var(--blue)} .kpi-card.free .kpi-value{color:var(--green)} .kpi-card.occupied .kpi-value{color:var(--red)} .kpi-card.bookings .kpi-value{color:var(--accent)}
  .kpi-card.rev .kpi-value{color:var(--green)} .kpi-card.avg .kpi-value{color:var(--blue)} .kpi-card.peak .kpi-value{color:var(--accent)} .kpi-card.cancel .kpi-value{color:var(--red)}
  .kpi-sub { font-family:var(--font-mono); font-size:10px; color:var(--muted); margin-top:8px; }
  .kpi-trend { font-family:var(--font-mono); font-size:10px; margin-top:6px; }
  .kpi-trend.up{color:var(--green)} .kpi-trend.down{color:var(--red)}

  /* ─── CHARTS ROW ─── */
  .charts-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px; }
  .charts-row-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; margin-bottom:16px; }
  .charts-row-full { margin-bottom:16px; }
  .chart-card { background:var(--surface); border:1px solid var(--border); padding:24px; }
  .chart-card.full { grid-column:1/-1; }
  .chart-title { font-family:var(--font-mono); font-size:11px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:20px; display:flex; align-items:center; justify-content:space-between; }
  .chart-badge { background:rgba(245,166,35,0.1); border:1px solid rgba(245,166,35,0.2); color:var(--accent); padding:2px 8px; font-size:9px; border-radius:2px; }

  /* Donut */
  .donut-wrap { display:flex; align-items:center; gap:32px; }
  .donut-svg { flex-shrink:0; }
  .donut-legend { display:flex; flex-direction:column; gap:12px; flex:1; }
  .legend-item { display:flex; align-items:center; gap:10px; }
  .legend-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
  .legend-label { font-family:var(--font-ui); font-size:13px; font-weight:600; color:var(--text); flex:1; }
  .legend-val { font-family:var(--font-mono); font-size:11px; color:var(--muted); }

  /* Bar chart */
  .bar-chart { display:flex; align-items:flex-end; gap:8px; height:140px; padding-top:20px; }
  .bar-chart.tall { height:180px; }
  .bar-col { display:flex; flex-direction:column; align-items:center; gap:6px; flex:1; }
  .bar { width:100%; background:linear-gradient(to top,var(--accent),rgba(245,166,35,0.4)); border-radius:2px 2px 0 0; transition:height 0.6s cubic-bezier(.23,1,.32,1); position:relative; cursor:pointer; }
  .bar.blue { background:linear-gradient(to top,var(--blue),rgba(58,159,216,0.3)); }
  .bar.green { background:linear-gradient(to top,var(--green),rgba(45,204,112,0.3)); }
  .bar.red { background:linear-gradient(to top,var(--red),rgba(232,50,10,0.3)); }
  .bar:hover { filter:brightness(1.3); }
  .bar-val { font-family:var(--font-mono); font-size:9px; color:var(--muted); position:absolute; top:-16px; left:50%; transform:translateX(-50%); white-space:nowrap; }
  .bar-label { font-family:var(--font-mono); font-size:9px; color:var(--muted); letter-spacing:1px; text-align:center; }

  /* Line chart SVG */
  .line-chart-wrap { position:relative; }
  .line-chart-svg { width:100%; overflow:visible; }
  .axis-label { font-family:var(--font-mono); font-size:9px; fill:#5a6370; }

  /* Occupancy gauge */
  .gauge-row { display:flex; gap:16px; }
  .gauge-item { flex:1; }
  .gauge-label { font-family:var(--font-mono); font-size:10px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-bottom:8px; }
  .gauge-track { height:8px; background:var(--surface2); border-radius:2px; overflow:hidden; margin-bottom:6px; }
  .gauge-fill { height:100%; border-radius:2px; transition:width 1s ease; }
  .gauge-val { font-family:var(--font-display); font-size:22px; letter-spacing:1px; }

  /* Hourly heatrow */
  .hour-grid { display:grid; grid-template-columns:repeat(24,1fr); gap:3px; margin-top:8px; }
  .hour-cell { height:36px; border-radius:2px; position:relative; cursor:pointer; transition:transform 0.15s; display:flex; align-items:center; justify-content:center; }
  .hour-cell:hover { transform:scaleY(1.15); z-index:2; }
  .hour-cell-label { font-family:var(--font-mono); font-size:7px; color:rgba(255,255,255,0.5); }
  .hour-axis { display:grid; grid-template-columns:repeat(24,1fr); gap:3px; margin-top:4px; }
  .hour-axis-label { font-family:var(--font-mono); font-size:8px; color:var(--muted); text-align:center; }

  /* Peak hours */
  .peak-list { display:flex; flex-direction:column; gap:8px; }
  .peak-row { display:flex; align-items:center; gap:12px; }
  .peak-time { font-family:var(--font-mono); font-size:11px; color:var(--text); min-width:70px; }
  .peak-track { flex:1; height:6px; background:var(--surface2); border-radius:2px; overflow:hidden; }
  .peak-fill { height:100%; border-radius:2px; }
  .peak-pct { font-family:var(--font-mono); font-size:10px; color:var(--muted); min-width:35px; text-align:right; }

  /* ─── HEATMAP ─── */
  .heatmap-controls { display:flex; gap:10px; margin-bottom:20px; align-items:center; }
  .heatmap-legend { display:flex; align-items:center; gap:8px; margin-left:auto; font-family:var(--font-mono); font-size:10px; color:var(--muted); }
  .heatmap-legend-bar { width:120px; height:8px; border-radius:2px; background:linear-gradient(to right,rgba(45,204,112,0.2),rgba(245,166,35,0.6),rgba(232,50,10,0.9)); }
  .heatmap-grid { display:grid; gap:6px; }
  .heatmap-zone-label { font-family:var(--font-mono); font-size:10px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px; margin-top:16px; padding-bottom:6px; border-bottom:1px solid var(--border); }
  .heatmap-row { display:grid; grid-template-columns:repeat(20,1fr); gap:5px; }
  .hmap-cell { aspect-ratio:1; border-radius:2px; position:relative; cursor:pointer; transition:transform 0.15s,box-shadow 0.15s; }
  .hmap-cell:hover { transform:scale(1.3); z-index:10; box-shadow:0 0 12px rgba(245,166,35,0.4); }
  .hmap-cell.free { background:rgba(45,204,112,0.15); border:1px solid rgba(45,204,112,0.25); }
  .hmap-cell.low { background:rgba(245,166,35,0.25); border:1px solid rgba(245,166,35,0.35); }
  .hmap-cell.medium { background:rgba(232,90,10,0.5); border:1px solid rgba(232,90,10,0.6); }
  .hmap-cell.high { background:rgba(232,50,10,0.85); border:1px solid rgba(232,50,10,0.9); }
  
  /* Tooltip */
  .tooltip { position:fixed; background:var(--surface); border:1px solid var(--accent); padding:12px 16px; z-index:9000; pointer-events:none; display:none; min-width:180px; box-shadow:0 8px 32px rgba(0,0,0,0.5); }
  .tooltip.show { display:block; }
  .tooltip-id { font-family:var(--font-display); font-size:22px; color:var(--accent); letter-spacing:2px; margin-bottom:8px; }
  .tooltip-row { font-family:var(--font-mono); font-size:10px; color:var(--muted); margin-bottom:4px; }
  .tooltip-row span { color:var(--text); }

  /* ─── REVENUE REPORT ─── */
  .report-filters { display:flex; gap:12px; margin-bottom:24px; flex-wrap:wrap; align-items:flex-end; }
  .filter-group { display:flex; flex-direction:column; gap:6px; }
  .filter-group label { font-family:var(--font-mono); font-size:9px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; }
  .filter-group select, .filter-group input { background:var(--surface2); border:1px solid var(--border); color:var(--text); padding:8px 12px; font-family:var(--font-mono); font-size:12px; outline:none; border-radius:2px; cursor:pointer; }
  .filter-group select:focus, .filter-group input:focus { border-color:var(--accent); }
  .report-summary { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:24px; }
  .summary-card { background:var(--surface); border:1px solid var(--border); padding:20px; border-top:3px solid; }
  .summary-card:nth-child(1){border-top-color:var(--green)}
  .summary-card:nth-child(2){border-top-color:var(--blue)}
  .summary-card:nth-child(3){border-top-color:var(--accent)}
  .summary-card:nth-child(4){border-top-color:var(--red)}
  .summary-label { font-family:var(--font-mono); font-size:9px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:10px; }
  .summary-value { font-family:var(--font-display); font-size:36px; letter-spacing:2px; line-height:1; }
  .summary-card:nth-child(1) .summary-value{color:var(--green)}
  .summary-card:nth-child(2) .summary-value{color:var(--blue)}
  .summary-card:nth-child(3) .summary-value{color:var(--accent)}
  .summary-card:nth-child(4) .summary-value{color:var(--red)}

  .report-table-wrap { background:var(--surface); border:1px solid var(--border); }
  .report-table-header { padding:16px 20px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
  .report-table-title { font-family:var(--font-mono); font-size:11px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; }
  .export-btn { font-family:var(--font-mono); font-size:10px; letter-spacing:1px; text-transform:uppercase; padding:6px 14px; border:1px solid var(--border); background:transparent; color:var(--muted); cursor:pointer; transition:all 0.2s; border-radius:2px; }
  .export-btn:hover { border-color:var(--green); color:var(--green); }

  /* ─── SLOTS ─── */
  .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:24px; }
  .section-title { font-family:var(--font-display); font-size:24px; letter-spacing:2px; }
  .filters { display:flex; gap:10px; }
  .filter-btn { font-family:var(--font-mono); font-size:10px; letter-spacing:1px; text-transform:uppercase; padding:6px 14px; border:1px solid var(--border); background:transparent; color:var(--muted); cursor:pointer; transition:all 0.2s; border-radius:2px; }
  .filter-btn:hover,.filter-btn.active { border-color:var(--accent); color:var(--accent); background:rgba(245,166,35,0.08); }
  .zone-section { margin-bottom:32px; }
  .zone-label { font-family:var(--font-mono); font-size:11px; color:var(--muted); letter-spacing:3px; text-transform:uppercase; margin-bottom:14px; padding-bottom:8px; border-bottom:1px solid var(--border); }
  .slots-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:10px; }
  .slot-card { background:var(--surface); border:1px solid var(--border); padding:16px 14px; cursor:pointer; transition:all 0.2s; position:relative; overflow:hidden; }
  .slot-card::after { content:''; position:absolute; bottom:0; left:0; width:100%; height:3px; }
  .slot-card.free::after{background:var(--green)} .slot-card.occupied::after{background:var(--red)} .slot-card.reserved::after{background:var(--yellow)}
  .slot-card:hover { border-color:var(--muted); transform:translateY(-1px); }
  .slot-id { font-family:var(--font-display); font-size:28px; letter-spacing:2px; line-height:1; margin-bottom:8px; }
  .slot-card.free .slot-id{color:var(--green)} .slot-card.occupied .slot-id{color:var(--red)} .slot-card.reserved .slot-id{color:var(--yellow)}
  .slot-status { font-family:var(--font-mono); font-size:9px; letter-spacing:2px; text-transform:uppercase; }
  .slot-card.free .slot-status{color:var(--green)} .slot-card.occupied .slot-status{color:var(--red)} .slot-card.reserved .slot-status{color:var(--yellow)}
  .slot-edit { position:absolute; top:8px; right:8px; background:var(--surface2); border:1px solid var(--border); color:var(--muted); width:24px; height:24px; display:flex; align-items:center; justify-content:center; font-size:11px; cursor:pointer; opacity:0; transition:opacity 0.2s; border-radius:2px; }
  .slot-card:hover .slot-edit { opacity:1; }

  /* ─── TABLE ─── */
  .table-wrap { background:var(--surface); border:1px solid var(--border); overflow:hidden; }
  table { width:100%; border-collapse:collapse; }
  thead tr { background:var(--surface2); border-bottom:1px solid var(--border); }
  th { font-family:var(--font-mono); font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--muted); padding:14px 18px; text-align:left; font-weight:400; }
  td { padding:14px 18px; border-bottom:1px solid var(--border); font-size:14px; font-weight:400; vertical-align:middle; }
  tr:last-child td { border-bottom:none; }
  tr:hover td { background:rgba(255,255,255,0.02); }
  .badge { display:inline-flex; align-items:center; gap:5px; padding:3px 10px; border-radius:2px; font-family:var(--font-mono); font-size:10px; letter-spacing:1px; text-transform:uppercase; font-weight:600; }
  .badge-green{background:rgba(45,204,112,0.12);color:var(--green);border:1px solid rgba(45,204,112,0.25)}
  .badge-red{background:rgba(232,50,10,0.12);color:var(--red);border:1px solid rgba(232,50,10,0.25)}
  .badge-yellow{background:rgba(245,166,35,0.12);color:var(--yellow);border:1px solid rgba(245,166,35,0.25)}
  .badge-blue{background:rgba(58,159,216,0.12);color:var(--blue);border:1px solid rgba(58,159,216,0.25)}
  .car-plate { font-family:var(--font-mono); font-size:12px; background:var(--surface2); border:1px solid var(--border); padding:3px 10px; border-radius:2px; letter-spacing:2px; color:var(--text); }
  .action-btn { font-family:var(--font-mono); font-size:10px; letter-spacing:1px; text-transform:uppercase; padding:5px 12px; border:1px solid var(--border); background:transparent; color:var(--muted); cursor:pointer; transition:all 0.2s; border-radius:2px; }
  .action-btn:hover { border-color:var(--accent); color:var(--accent); }
  .primary-btn { font-family:var(--font-mono); font-size:11px; letter-spacing:2px; text-transform:uppercase; padding:10px 20px; border:1px solid var(--accent); background:rgba(245,166,35,0.1); color:var(--accent); cursor:pointer; transition:all 0.2s; border-radius:2px; font-weight:600; }
  .primary-btn:hover { background:var(--accent); color:var(--bg); }
  .time-text { font-family:var(--font-mono); font-size:11px; color:var(--muted); }

  /* ─── MODAL ─── */
  .modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:999; align-items:center; justify-content:center; backdrop-filter:blur(4px); }
  .modal-overlay.open { display:flex; }
  .modal { background:var(--surface); border:1px solid var(--border); width:420px; padding:32px; animation:slideUp 0.3s ease; }
  @keyframes slideUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
  .modal-title { font-family:var(--font-display); font-size:24px; letter-spacing:2px; margin-bottom:24px; color:var(--accent); }
  .form-group { margin-bottom:18px; }
  .form-label { font-family:var(--font-mono); font-size:10px; color:var(--muted); letter-spacing:2px; text-transform:uppercase; display:block; margin-bottom:8px; }
  .form-select,.form-input { width:100%; background:var(--surface2); border:1px solid var(--border); color:var(--text); padding:10px 14px; font-family:var(--font-mono); font-size:13px; outline:none; border-radius:2px; transition:border-color 0.2s; }
  .form-select:focus,.form-input:focus { border-color:var(--accent); }
  .modal-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:24px; }
  .cancel-btn { font-family:var(--font-mono); font-size:11px; letter-spacing:1px; text-transform:uppercase; padding:10px 20px; border:1px solid var(--border); background:transparent; color:var(--muted); cursor:pointer; transition:all 0.2s; border-radius:2px; }
  .cancel-btn:hover { border-color:var(--muted); color:var(--text); }

  /* Occupancy bar on dashboard */
  .occupancy-bar-wrap { display:flex; align-items:center; gap:10px; margin-top:16px; }
  .occupancy-track { flex:1; height:4px; background:var(--surface2); border-radius:2px; overflow:hidden; }
  .occupancy-fill { height:100%; background:linear-gradient(to right,var(--green),var(--accent),var(--red)); border-radius:2px; transition:width 1s ease; }
  .occupancy-pct { font-family:var(--font-display); font-size:16px; color:var(--accent); }

  /* separator */
  .section-sep { border:none; border-top:1px solid var(--border); margin:24px 0; }
</style>
</head>
<body>

<!-- TOOLTIP -->
<div class="tooltip" id="tooltip">
  <div class="tooltip-id" id="tt-id">A01</div>
  <div class="tooltip-row">Plate: <span id="tt-plate">—</span></div>
  <div class="tooltip-row">Duration: <span id="tt-dur">—</span></div>
  <div class="tooltip-row">Revenue Today: <span id="tt-rev">—</span></div>
  <div class="tooltip-row">Status: <span id="tt-status">—</span></div>
</div>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-title">PARKY</div>
    <div class="logo-sub">Management System v2.0</div>
  </div>
  <nav class="nav">
    <div class="nav-group-label">Core</div>
    <div class="nav-item active" onclick="showPage('dashboard',this)"><span class="nav-icon">⬛</span>Dashboard</div>
    <div class="nav-item" onclick="showPage('slots',this)"><span class="nav-icon">⊞</span>Slots</div>
    <div class="nav-item" onclick="showPage('bookings',this)"><span class="nav-icon">◧</span>Bookings</div>
    <div class="nav-group-label">Analytics</div>
    <div class="nav-item" onclick="showPage('analytics',this)"><span class="nav-icon">▲</span>Revenue</div>
    <div class="nav-item" onclick="showPage('occupancy',this)"><span class="nav-icon">◉</span>Occupancy</div>
    <div class="nav-item" onclick="showPage('heatmap',this)"><span class="nav-icon">⣿</span>Heat Map</div>
    <div class="nav-item" onclick="showPage('reports',this)"><span class="nav-icon">≡</span>Reports</div>
  </nav>
  <div class="sidebar-status">
    <div class="status-text"><span class="status-dot"></span>SYSTEM ONLINE</div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <div class="page-title" id="topbarTitle">DASHBOARD</div>
    <div class="topbar-right">
      <div class="live-badge"><span class="status-dot"></span>LIVE</div>
      <div class="time-text" id="clock">--:--:--</div>
    </div>
  </div>

  <div class="content">

    <!-- ══════════════════════════════════════════════
         DASHBOARD
    ══════════════════════════════════════════════ -->
    <div class="page active" id="page-dashboard">
      <div class="kpi-grid">
        <div class="kpi-card total">
          <div class="kpi-label">Total Slots</div>
          <div class="kpi-value">60</div>
          <div class="kpi-sub">ACROSS 3 ZONES</div>
          <div class="occupancy-bar-wrap">
            <div class="occupancy-track"><div class="occupancy-fill" style="width:72%"></div></div>
            <div class="occupancy-pct">72%</div>
          </div>
        </div>
        <div class="kpi-card free">
          <div class="kpi-label">Free Slots</div>
          <div class="kpi-value">17</div>
          <div class="kpi-sub">AVAILABLE NOW</div>
        </div>
        <div class="kpi-card occupied">
          <div class="kpi-label">Occupied</div>
          <div class="kpi-value">35</div>
          <div class="kpi-sub">IN USE</div>
        </div>
        <div class="kpi-card bookings">
          <div class="kpi-label">Bookings Today</div>
          <div class="kpi-value">8</div>
          <div class="kpi-sub">↑ 2 FROM YESTERDAY</div>
        </div>
      </div>
      <div class="charts-row">
        <div class="chart-card">
          <div class="chart-title">// SLOT DISTRIBUTION</div>
          <div class="donut-wrap">
            <svg class="donut-svg" width="140" height="140" viewBox="0 0 140 140">
              <circle cx="70" cy="70" r="55" fill="none" stroke="#1a1f26" stroke-width="22"/>
              <circle cx="70" cy="70" r="55" fill="none" stroke="#2dcc70" stroke-width="22" stroke-dasharray="97 248" stroke-dashoffset="0" transform="rotate(-90 70 70)"/>
              <circle cx="70" cy="70" r="55" fill="none" stroke="#e8320a" stroke-width="22" stroke-dasharray="200 145" stroke-dashoffset="-97" transform="rotate(-90 70 70)"/>
              <circle cx="70" cy="70" r="55" fill="none" stroke="#f5a623" stroke-width="22" stroke-dasharray="48 297" stroke-dashoffset="-297" transform="rotate(-90 70 70)"/>
              <text x="70" y="65" text-anchor="middle" fill="#e8eaed" font-family="Bebas Neue" font-size="22" letter-spacing="1">60</text>
              <text x="70" y="82" text-anchor="middle" fill="#5a6370" font-family="JetBrains Mono" font-size="9">TOTAL</text>
            </svg>
            <div class="donut-legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div><div class="legend-label">Free</div><div class="legend-val">17</div></div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--red)"></div><div class="legend-label">Occupied</div><div class="legend-val">35</div></div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--yellow)"></div><div class="legend-label">Reserved</div><div class="legend-val">8</div></div>
            </div>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">// BOOKINGS THIS WEEK</div>
          <div class="bar-chart" id="barChart"></div>
        </div>
      </div>
    </div>

    <!-- ══════════════════════════════════════════════
         SLOTS
    ══════════════════════════════════════════════ -->
    <div class="page" id="page-slots">
      <div class="section-header">
        <div class="section-title">SLOT MANAGEMENT</div>
        <div class="filters">
          <button class="filter-btn active" onclick="filterSlots('all',this)">All</button>
          <button class="filter-btn" onclick="filterSlots('free',this)">Free</button>
          <button class="filter-btn" onclick="filterSlots('occupied',this)">Occupied</button>
          <button class="filter-btn" onclick="filterSlots('reserved',this)">Reserved</button>
        </div>
      </div>
      <div id="zones-container"></div>
    </div>

    <!-- ══════════════════════════════════════════════
         BOOKINGS
    ══════════════════════════════════════════════ -->
    <div class="page" id="page-bookings">
      <div class="section-header">
        <div class="section-title">BOOKINGS</div>
        <button class="primary-btn" onclick="openModal('add')">+ NEW BOOKING</button>
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>#ID</th><th>Name</th><th>Plate</th><th>Slot</th><th>Entry</th><th>Exit</th><th>Payment</th><th>Status</th><th>Action</th></tr></thead>
          <tbody id="bookings-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ══════════════════════════════════════════════
         ANALYTICS — REVENUE
    ══════════════════════════════════════════════ -->
    <div class="page" id="page-analytics">
      <div class="kpi-grid" style="grid-template-columns:repeat(4,1fr);">
        <div class="kpi-card rev">
          <div class="kpi-label">Total Revenue</div>
          <div class="kpi-value" style="font-size:38px;">2,840</div>
          <div class="kpi-sub">EGP — THIS MONTH</div>
          <div class="kpi-trend up">↑ 18% VS LAST MONTH</div>
        </div>
        <div class="kpi-card avg">
          <div class="kpi-label">Avg / Booking</div>
          <div class="kpi-value" style="font-size:38px;">355</div>
          <div class="kpi-sub">EGP AVERAGE</div>
          <div class="kpi-trend up">↑ 5% VS LAST MONTH</div>
        </div>
        <div class="kpi-card peak">
          <div class="kpi-label">Best Day</div>
          <div class="kpi-value" style="font-size:38px;">480</div>
          <div class="kpi-sub">EGP — FRIDAY</div>
          <div class="kpi-trend up">PEAK REVENUE DAY</div>
        </div>
        <div class="kpi-card cancel">
          <div class="kpi-label">Unpaid</div>
          <div class="kpi-value" style="font-size:38px;">620</div>
          <div class="kpi-sub">EGP OUTSTANDING</div>
          <div class="kpi-trend down">↑ 4 UNPAID BOOKINGS</div>
        </div>
      </div>

      <div class="charts-row">
        <!-- Daily Revenue Bar -->
        <div class="chart-card">
          <div class="chart-title">// DAILY REVENUE (EGP) <span class="chart-badge">THIS WEEK</span></div>
          <div class="bar-chart tall" id="revenueBarChart"></div>
        </div>
        <!-- Revenue by Zone Donut -->
        <div class="chart-card">
          <div class="chart-title">// REVENUE BY ZONE</div>
          <div class="donut-wrap">
            <svg width="140" height="140" viewBox="0 0 140 140">
              <circle cx="70" cy="70" r="55" fill="none" stroke="#1a1f26" stroke-width="22"/>
              <!-- Zone A 45% -->
              <circle cx="70" cy="70" r="55" fill="none" stroke="#3a9fd8" stroke-width="22" stroke-dasharray="155 190" stroke-dashoffset="0" transform="rotate(-90 70 70)"/>
              <!-- Zone B 33% -->
              <circle cx="70" cy="70" r="55" fill="none" stroke="#f5a623" stroke-width="22" stroke-dasharray="114 231" stroke-dashoffset="-155" transform="rotate(-90 70 70)"/>
              <!-- Zone C 22% -->
              <circle cx="70" cy="70" r="55" fill="none" stroke="#2dcc70" stroke-width="22" stroke-dasharray="76 269" stroke-dashoffset="-269" transform="rotate(-90 70 70)"/>
              <text x="70" y="65" text-anchor="middle" fill="#e8eaed" font-family="Bebas Neue" font-size="18">2840</text>
              <text x="70" y="82" text-anchor="middle" fill="#5a6370" font-family="JetBrains Mono" font-size="9">EGP</text>
            </svg>
            <div class="donut-legend">
              <div class="legend-item"><div class="legend-dot" style="background:var(--blue)"></div><div class="legend-label">Zone A</div><div class="legend-val">1,278</div></div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div><div class="legend-label">Zone B</div><div class="legend-val">937</div></div>
              <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div><div class="legend-label">Zone C</div><div class="legend-val">625</div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Monthly Line Chart -->
      <div class="chart-card charts-row-full">
        <div class="chart-title">// MONTHLY REVENUE TREND (EGP) <span class="chart-badge">LAST 12 MONTHS</span></div>
        <div class="line-chart-wrap">
          <svg class="line-chart-svg" height="160" id="lineChartSvg" viewBox="0 0 800 160" preserveAspectRatio="none">
            <defs>
              <linearGradient id="lineGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#f5a623" stop-opacity="0.3"/>
                <stop offset="100%" stop-color="#f5a623" stop-opacity="0"/>
              </linearGradient>
            </defs>
            <path id="lineChartArea" fill="url(#lineGrad)"/>
            <path id="lineChartPath" fill="none" stroke="#f5a623" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            <g id="lineChartDots"></g>
            <g id="lineChartLabels"></g>
          </svg>
        </div>
      </div>

      <!-- Booking Trends -->
      <div class="charts-row">
        <div class="chart-card">
          <div class="chart-title">// BOOKINGS PER DAY <span class="chart-badge">LAST 7 DAYS</span></div>
          <div class="bar-chart" id="bookingTrendChart"></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">// BOOKING METRICS</div>
          <div style="display:flex;flex-direction:column;gap:20px;margin-top:8px;">
            <div>
              <div class="gauge-label">CANCELLATION RATE</div>
              <div class="gauge-track"><div class="gauge-fill" style="width:12%;background:var(--red)"></div></div>
              <div style="display:flex;justify-content:space-between;margin-top:4px;">
                <div class="gauge-val" style="color:var(--red);">12%</div>
                <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);">TARGET &lt;10%</div>
              </div>
            </div>
            <div>
              <div class="gauge-label">REPEAT CUSTOMERS</div>
              <div class="gauge-track"><div class="gauge-fill" style="width:68%;background:var(--green)"></div></div>
              <div style="display:flex;justify-content:space-between;margin-top:4px;">
                <div class="gauge-val" style="color:var(--green);">68%</div>
                <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);">RETURNING</div>
              </div>
            </div>
            <div>
              <div class="gauge-label">PAYMENT RATE</div>
              <div class="gauge-track"><div class="gauge-fill" style="width:79%;background:var(--blue)"></div></div>
              <div style="display:flex;justify-content:space-between;margin-top:4px;">
                <div class="gauge-val" style="color:var(--blue);">79%</div>
                <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);">PAID ON TIME</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══════════════════════════════════════════════
         OCCUPANCY ANALYTICS
    ══════════════════════════════════════════════ -->
    <div class="page" id="page-occupancy">
      <div class="kpi-grid">
        <div class="kpi-card rev">
          <div class="kpi-label">Avg Occupancy</div>
          <div class="kpi-value" style="font-size:48px;">72%</div>
          <div class="kpi-sub">TODAY</div>
          <div class="kpi-trend up">↑ 8% VS YESTERDAY</div>
        </div>
        <div class="kpi-card avg">
          <div class="kpi-label">Peak Hour</div>
          <div class="kpi-value" style="font-size:48px;">11AM</div>
          <div class="kpi-sub">BUSIEST TIME</div>
          <div class="kpi-trend up">94% OCCUPANCY</div>
        </div>
        <div class="kpi-card peak">
          <div class="kpi-label">Best Zone</div>
          <div class="kpi-value" style="font-size:48px;">A</div>
          <div class="kpi-sub">HIGHEST UTILIZATION</div>
          <div class="kpi-trend up">88% OCCUPIED</div>
        </div>
        <div class="kpi-card cancel">
          <div class="kpi-label">Lowest Hour</div>
          <div class="kpi-value" style="font-size:48px;">3AM</div>
          <div class="kpi-sub">QUIETEST</div>
          <div class="kpi-trend down">8% OCCUPANCY</div>
        </div>
      </div>

      <!-- Hourly Occupancy -->
      <div class="chart-card charts-row-full" style="margin-bottom:16px;">
        <div class="chart-title">// HOURLY OCCUPANCY RATE — 24H VIEW <span class="chart-badge">TODAY</span></div>
        <div class="bar-chart tall" id="hourlyOccChart" style="gap:4px;"></div>
        <div style="display:flex;gap:4px;margin-top:6px;" id="hourlyOccLabels"></div>
      </div>

      <!-- Peak Hours + Zone Utilization -->
      <div class="charts-row">
        <div class="chart-card">
          <div class="chart-title">// PEAK HOURS DETECTION</div>
          <div class="peak-list" id="peakList"></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">// ZONE UTILIZATION %</div>
          <div style="display:flex;flex-direction:column;gap:20px;margin-top:8px;">
            <div class="gauge-item">
              <div class="gauge-label">ZONE A</div>
              <div class="gauge-track"><div class="gauge-fill" style="width:88%;background:var(--red)"></div></div>
              <div style="display:flex;justify-content:space-between;margin-top:4px;">
                <div class="gauge-val" style="color:var(--red)">88%</div>
                <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);">18/20 SLOTS</div>
              </div>
            </div>
            <div class="gauge-item">
              <div class="gauge-label">ZONE B</div>
              <div class="gauge-track"><div class="gauge-fill" style="width:70%;background:var(--accent)"></div></div>
              <div style="display:flex;justify-content:space-between;margin-top:4px;">
                <div class="gauge-val" style="color:var(--accent)">70%</div>
                <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);">14/20 SLOTS</div>
              </div>
            </div>
            <div class="gauge-item">
              <div class="gauge-label">ZONE C</div>
              <div class="gauge-track"><div class="gauge-fill" style="width:57%;background:var(--blue)"></div></div>
              <div style="display:flex;justify-content:space-between;margin-top:4px;">
                <div class="gauge-val" style="color:var(--blue)">57%</div>
                <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);">11/20 SLOTS</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══════════════════════════════════════════════
         HEAT MAP
    ══════════════════════════════════════════════ -->
    <div class="page" id="page-heatmap">
      <div class="section-header">
        <div class="section-title">LIVE HEAT MAP</div>
        <div style="display:flex;align-items:center;gap:16px;">
          <div class="heatmap-legend">
            <span>LOW</span>
            <div class="heatmap-legend-bar"></div>
            <span>HIGH</span>
          </div>
        </div>
      </div>
      <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);margin-bottom:20px;letter-spacing:1px;">
        ◉ Hover over any slot to see details &nbsp;·&nbsp; Color intensity = revenue generated today
      </div>
      <div id="heatmap-container"></div>
    </div>

    <!-- ══════════════════════════════════════════════
         REVENUE REPORTS
    ══════════════════════════════════════════════ -->
    <div class="page" id="page-reports">
      <div class="section-header">
        <div class="section-title">REVENUE REPORTS</div>
        <button class="export-btn" onclick="exportCSV()">⬇ EXPORT CSV</button>
      </div>

      <!-- Filters -->
      <div class="report-filters">
        <div class="filter-group">
          <label>Date From</label>
          <input type="date" id="rpt-from" value="2026-02-01">
        </div>
        <div class="filter-group">
          <label>Date To</label>
          <input type="date" id="rpt-to" value="2026-02-17">
        </div>
        <div class="filter-group">
          <label>Zone</label>
          <select id="rpt-zone">
            <option value="all">All Zones</option>
            <option value="A">Zone A</option>
            <option value="B">Zone B</option>
            <option value="C">Zone C</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Payment</label>
          <select id="rpt-pay">
            <option value="all">All</option>
            <option value="paid">Paid</option>
            <option value="unpaid">Unpaid</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Status</label>
          <select id="rpt-status">
            <option value="all">All</option>
            <option value="completed">Completed</option>
            <option value="active">Active</option>
            <option value="reserved">Reserved</option>
          </select>
        </div>
        <button class="primary-btn" onclick="applyReportFilters()" style="align-self:flex-end;">APPLY</button>
      </div>

      <!-- Summary -->
      <div class="report-summary" id="report-summary">
        <div class="summary-card">
          <div class="summary-label">Total Revenue</div>
          <div class="summary-value" id="rpt-total-rev">—</div>
          <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);margin-top:6px;">EGP</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Total Bookings</div>
          <div class="summary-value" id="rpt-total-bk">—</div>
          <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);margin-top:6px;">RECORDS</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Avg / Booking</div>
          <div class="summary-value" id="rpt-avg-rev">—</div>
          <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);margin-top:6px;">EGP</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Avg Duration</div>
          <div class="summary-value" id="rpt-avg-dur">—</div>
          <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);margin-top:6px;">HOURS</div>
        </div>
      </div>

      <!-- Report Table -->
      <div class="report-table-wrap">
        <div class="report-table-header">
          <div class="report-table-title">// TRANSACTION RECORDS</div>
          <div style="font-family:var(--font-mono);font-size:10px;color:var(--muted);" id="rpt-record-count"></div>
        </div>
        <table>
          <thead>
            <tr>
              <th>#ID</th><th>Name</th><th>Plate</th><th>Slot</th><th>Zone</th>
              <th>Entry</th><th>Exit</th><th>Duration</th><th>Revenue</th><th>Payment</th><th>Status</th>
            </tr>
          </thead>
          <tbody id="report-tbody"></tbody>
        </table>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- MODALS -->
<div class="modal-overlay" id="slotModal">
  <div class="modal">
    <div class="modal-title">EDIT SLOT</div>
    <div class="form-group"><label class="form-label">Slot ID</label><input class="form-input" id="modal-slot-id" readonly></div>
    <div class="form-group"><label class="form-label">Zone</label><input class="form-input" id="modal-slot-zone" readonly></div>
    <div class="form-group"><label class="form-label">Status</label>
      <select class="form-select" id="modal-slot-status">
        <option value="free">Free</option><option value="occupied">Occupied</option><option value="reserved">Reserved</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="cancel-btn" onclick="closeModal('slotModal')">Cancel</button>
      <button class="primary-btn" onclick="saveSlot()">Save Changes</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="bookingModal">
  <div class="modal">
    <div class="modal-title">NEW BOOKING</div>
    <div class="form-group"><label class="form-label">Full Name</label><input class="form-input" id="new-name" placeholder="Ahmed Mohamed"></div>
    <div class="form-group"><label class="form-label">Car Plate</label><input class="form-input" id="new-plate" placeholder="ABC-1234"></div>
    <div class="form-group"><label class="form-label">Slot</label><select class="form-select" id="new-slot"></select></div>
    <div class="form-group"><label class="form-label">Entry Time</label><input class="form-input" id="new-entry" type="datetime-local"></div>
    <div class="form-group"><label class="form-label">Exit Time</label><input class="form-input" id="new-exit" type="datetime-local"></div>
    <div class="modal-actions">
      <button class="cancel-btn" onclick="closeModal('bookingModal')">Cancel</button>
      <button class="primary-btn" onclick="addBooking()">Create Booking</button>
    </div>
  </div>
</div>

<script>
// ═══════════════════════════════════════════════════════════════
// DATA
// ═══════════════════════════════════════════════════════════════
const zones = { 'Zone A':[], 'Zone B':[], 'Zone C':[] };
const statuses = ['free','occupied','occupied','reserved','free','occupied','occupied','free','occupied','free','occupied','reserved','occupied','free','occupied','occupied','reserved','free','occupied','occupied'];
['A','B','C'].forEach((z,zi) => {
  for(let i=1;i<=20;i++){
    const idx=zi*20+i-1;
    zones[`Zone ${z}`].push({ id:`${z}${String(i).padStart(2,'0')}`, status:statuses[idx%statuses.length], zone:`Zone ${z}` });
  }
});

const plates = ['ABC-1234','XYZ-5678','MNO-9999','QRS-3456','TUV-7890','DEF-2222','GHI-3333','JKL-4444','VWX-1111','RST-8888','BCD-5555','EFG-6666'];
const names  = ['Mohamed Ayman','Mohamed Hamed','Khaled','Dina','Farah','Basant','Hazem','Omar'];

let bookings = [
  { id:'BK-001', name:'Mohamed Ayman',  plate:'ABC-1234', slot:'A03', zone:'A', entry:'2026-02-17 08:00', exit:'2026-02-17 10:00', duration:2, revenue:200, paid:true,  status:'completed' },
  { id:'BK-002', name:'Mohamed Hamed',   plate:'XYZ-5678', slot:'B07', zone:'B', entry:'2026-02-17 09:30', exit:'2026-02-17 11:30', duration:2, revenue:200, paid:false, status:'active'    },
  { id:'BK-003', name:'Khaled ',   plate:'MNO-9999', slot:'A11', zone:'A', entry:'2026-02-17 10:00', exit:'2026-02-17 12:00', duration:2, revenue:200, paid:true,  status:'active'    },
  { id:'BK-004', name:'Dina',    plate:'QRS-3456', slot:'C02', zone:'C', entry:'2026-02-17 07:00', exit:'2026-02-17 09:00', duration:2, revenue:200, paid:true,  status:'completed' },
  { id:'BK-005', name:'Farah', plate:'TUV-7890', slot:'B15', zone:'B', entry:'2026-02-17 11:00', exit:'2026-02-17 13:00', duration:2, revenue:200, paid:false, status:'reserved'  },
  { id:'BK-006', name:'Basant', plate:'DEF-2222', slot:'A08', zone:'A', entry:'2026-02-17 12:00', exit:'2026-02-17 15:00', duration:3, revenue:300, paid:false, status:'active'    },
  { id:'BK-007', name:'Hazem', plate:'GHI-3333', slot:'C18', zone:'C', entry:'2026-02-17 08:30', exit:'2026-02-17 10:30', duration:2, revenue:200, paid:true,  status:'completed' },
  { id:'BK-008', name:'Omar',   plate:'JKL-4444', slot:'B03', zone:'B', entry:'2026-02-17 13:00', exit:'2026-02-17 16:00', duration:3, revenue:300, paid:false, status:'reserved'  },
];

// Heatmap slot data
const heatSlots = {};
Object.entries(zones).forEach(([zoneName, slots]) => {
  slots.forEach(s => {
    const occ = s.status === 'occupied';
    const rev = occ ? Math.floor(Math.random()*200+50) : 0;
    const dur = occ ? (Math.random()*4+0.5).toFixed(1) : 0;
    const plateIdx = Math.floor(Math.random()*plates.length);
    heatSlots[s.id] = {
      id: s.id, status: s.status, zone: zoneName,
      plate: occ ? plates[plateIdx] : '—',
      duration: occ ? `${dur}h` : '—',
      revenue: occ ? `${rev} EGP` : '0 EGP',
      intensity: occ ? rev : 0
    };
  });
});

let editingSlotId = null;
let bookingCounter = 9;

// ═══════════════════════════════════════════════════════════════
// CLOCK
// ═══════════════════════════════════════════════════════════════
function updateClock() { document.getElementById('clock').textContent = new Date().toTimeString().slice(0,8); }
setInterval(updateClock,1000); updateClock();

// ═══════════════════════════════════════════════════════════════
// NAVIGATION
// ═══════════════════════════════════════════════════════════════
function showPage(page, el) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  el.classList.add('active');
  document.getElementById('topbarTitle').textContent = {
    dashboard:'DASHBOARD', slots:'SLOT MANAGEMENT', bookings:'BOOKINGS',
    analytics:'REVENUE ANALYTICS', occupancy:'OCCUPANCY ANALYTICS',
    heatmap:'HEAT MAP', reports:'REVENUE REPORTS'
  }[page] || page.toUpperCase();
  // lazy render
  if(page==='analytics') { renderRevenuePage(); }
  if(page==='occupancy') { renderOccupancyPage(); }
  if(page==='heatmap')   { renderHeatmap(); }
  if(page==='reports')   { applyReportFilters(); }
}

// ═══════════════════════════════════════════════════════════════
// SLOTS
// ═══════════════════════════════════════════════════════════════
function renderSlots(filter='all') {
  const container = document.getElementById('zones-container');
  container.innerHTML = '';
  Object.entries(zones).forEach(([zoneName,slots]) => {
    const filtered = filter==='all' ? slots : slots.filter(s=>s.status===filter);
    if(!filtered.length) return;
    const sec = document.createElement('div'); sec.className='zone-section';
    sec.innerHTML = `<div class="zone-label">// ${zoneName} — ${filtered.length} slots shown</div>
    <div class="slots-grid">${filtered.map(slot=>`
      <div class="slot-card ${slot.status}" onclick="editSlot('${slot.id}')">
        <button class="slot-edit" onclick="event.stopPropagation();editSlot('${slot.id}')">✎</button>
        <div class="slot-id">${slot.id}</div>
        <div class="slot-status">${slot.status}</div>
      </div>`).join('')}</div>`;
    container.appendChild(sec);
  });
}
function filterSlots(val,btn) {
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderSlots(val);
}
function editSlot(id) {
  let found; Object.values(zones).forEach(arr=>arr.forEach(s=>{if(s.id===id)found=s;}));
  if(!found) return;
  editingSlotId=id;
  document.getElementById('modal-slot-id').value=found.id;
  document.getElementById('modal-slot-zone').value=found.zone;
  document.getElementById('modal-slot-status').value=found.status;
  document.getElementById('slotModal').classList.add('open');
}
function saveSlot() {
  const ns=document.getElementById('modal-slot-status').value;
  Object.values(zones).forEach(arr=>arr.forEach(s=>{if(s.id===editingSlotId)s.status=ns;}));
  closeModal('slotModal'); renderSlots('all');
  document.querySelector('.filter-btn.active')?.click();
}

// ═══════════════════════════════════════════════════════════════
// BOOKINGS
// ═══════════════════════════════════════════════════════════════
function renderBookings() {
  document.getElementById('bookings-tbody').innerHTML = bookings.map(b=>`
    <tr>
      <td><span style="font-family:var(--font-mono);font-size:12px;color:var(--muted)">${b.id}</span></td>
      <td>${b.name}</td>
      <td><span class="car-plate">${b.plate}</span></td>
      <td><span style="font-family:var(--font-mono);font-weight:600;color:var(--accent)">${b.slot}</span></td>
      <td><span class="time-text">${b.entry}</span></td>
      <td><span class="time-text">${b.exit||'—'}</span></td>
      <td>${b.paid?'<span class="badge badge-green">✓ Paid</span>':'<span class="badge badge-red">✗ Unpaid</span>'}</td>
      <td>${statusBadge(b.status)}</td>
      <td><button class="action-btn" onclick="deleteBooking('${b.id}')">Remove</button></td>
    </tr>`).join('');
}
function statusBadge(s){
  return `<span class="badge badge-${s==='completed'?'green':s==='active'?'blue':'yellow'}">${s}</span>`;
}
function deleteBooking(id){ bookings=bookings.filter(b=>b.id!==id); renderBookings(); }
function openModal(type) {
  if(type==='add'){
    const sel=document.getElementById('new-slot'); sel.innerHTML='';
    Object.values(zones).forEach(arr=>arr.filter(s=>s.status==='free').forEach(s=>{
      const o=document.createElement('option'); o.value=s.id; o.textContent=`${s.id} (${s.zone})`; sel.appendChild(o);
    }));
    document.getElementById('new-entry').value=new Date().toISOString().slice(0,16);
    document.getElementById('bookingModal').classList.add('open');
  }
}
function addBooking(){
  const name=document.getElementById('new-name').value.trim();
  const plate=document.getElementById('new-plate').value.trim();
  const slot=document.getElementById('new-slot').value;
  const entry=document.getElementById('new-entry').value;
  const exit=document.getElementById('new-exit').value;
  if(!name||!plate||!slot){alert('Please fill all required fields');return;}
  const zn = slot[0];
  bookings.unshift({
    id:`BK-${String(bookingCounter++).padStart(3,'0')}`,
    name,plate,slot,zone:zn,
    entry:entry.replace('T',' '),
    exit:exit?exit.replace('T',' '):'—',
    duration:2, revenue:200, paid:false, status:'reserved'
  });
  Object.values(zones).forEach(arr=>arr.forEach(s=>{if(s.id===slot)s.status='reserved';}));
  closeModal('bookingModal'); renderBookings();
  document.getElementById('new-name').value='';
  document.getElementById('new-plate').value='';
}
function closeModal(id){ document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open');}));

// ═══════════════════════════════════════════════════════════════
// DASHBOARD BAR CHART
// ═══════════════════════════════════════════════════════════════
function renderBarChart(){
  const data=[{day:'MON',val:12},{day:'TUE',val:19},{day:'WED',val:8},{day:'THU',val:24},{day:'FRI',val:31},{day:'SAT',val:15},{day:'SUN',val:8}];
  const max=Math.max(...data.map(d=>d.val));
  document.getElementById('barChart').innerHTML=data.map(d=>`
    <div class="bar-col">
      <div class="bar" style="height:${(d.val/max)*120}px"><span class="bar-val">${d.val}</span></div>
      <div class="bar-label">${d.day}</div>
    </div>`).join('');
}

// ═══════════════════════════════════════════════════════════════
// ANALYTICS — REVENUE PAGE
// ═══════════════════════════════════════════════════════════════
function renderRevenuePage(){
  // Daily Revenue Bar
  const daily=[{d:'MON',v:320},{d:'TUE',v:480},{d:'WED',v:210},{d:'THU',v:390},{d:'FRI',v:480},{d:'SAT',v:350},{d:'SUN',v:210}];
  const maxD=Math.max(...daily.map(x=>x.v));
  const rb=document.getElementById('revenueBarChart');
  if(rb) rb.innerHTML=daily.map(d=>`
    <div class="bar-col">
      <div class="bar green" style="height:${(d.v/maxD)*160}px"><span class="bar-val">${d.v}</span></div>
      <div class="bar-label">${d.d}</div>
    </div>`).join('');

  // Booking Trend
  const btrend=[{d:'TUE',v:6},{d:'WED',v:4},{d:'THU',v:9},{d:'FRI',v:12},{d:'SAT',v:8},{d:'SUN',v:5},{d:'MON',v:8}];
  const maxB=Math.max(...btrend.map(x=>x.v));
  const bt=document.getElementById('bookingTrendChart');
  if(bt) bt.innerHTML=btrend.map(d=>`
    <div class="bar-col">
      <div class="bar blue" style="height:${(d.v/maxB)*120}px"><span class="bar-val">${d.v}</span></div>
      <div class="bar-label">${d.d}</div>
    </div>`).join('');

  // Monthly Line Chart
  renderLineChart();
}

function renderLineChart(){
  const monthlyData=[1800,2100,1600,2400,2200,2800,2600,3100,2900,3300,3000,2840];
  const months=['MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC','JAN','FEB'];
  const W=800, H=140, padX=30, padY=20;
  const minV=Math.min(...monthlyData)-200;
  const maxV=Math.max(...monthlyData)+200;
  const toX=i=>padX+(i/(monthlyData.length-1))*(W-padX*2);
  const toY=v=>H-padY-((v-minV)/(maxV-minV))*(H-padY*2);

  const pts=monthlyData.map((v,i)=>`${toX(i)},${toY(v)}`).join(' ');
  const pathD=`M ${monthlyData.map((v,i)=>`${toX(i)} ${toY(v)}`).join(' L ')}`;
  const areaD=`M ${toX(0)} ${H-padY} L ${monthlyData.map((v,i)=>`${toX(i)} ${toY(v)}`).join(' L ')} L ${toX(monthlyData.length-1)} ${H-padY} Z`;

  const svg=document.getElementById('lineChartSvg');
  if(!svg) return;
  document.getElementById('lineChartPath').setAttribute('d',pathD);
  document.getElementById('lineChartArea').setAttribute('d',areaD);

  // dots
  document.getElementById('lineChartDots').innerHTML=monthlyData.map((v,i)=>
    `<circle cx="${toX(i)}" cy="${toY(v)}" r="4" fill="#f5a623" stroke="#0a0c0f" stroke-width="2">
      <title>${months[i]}: ${v} EGP</title>
    </circle>`
  ).join('');

  // labels
  document.getElementById('lineChartLabels').innerHTML=months.map((m,i)=>
    `<text x="${toX(i)}" y="${H}" class="axis-label" text-anchor="middle">${m}</text>`
  ).join('');
}

// ═══════════════════════════════════════════════════════════════
// OCCUPANCY PAGE
// ═══════════════════════════════════════════════════════════════
function renderOccupancyPage(){
  // 24-hour occupancy data (%)
  const hourly=[8,5,4,3,6,14,28,55,72,85,92,94,88,80,75,78,82,86,74,62,48,35,22,12];

  const chart=document.getElementById('hourlyOccChart');
  const labels=document.getElementById('hourlyOccLabels');
  if(!chart) return;

  const maxH=Math.max(...hourly);
  chart.innerHTML=hourly.map((v,i)=>{
    let cls='green'; if(v>60)cls=''; if(v>80)cls='red';
    const color=v>80?'var(--red)':v>60?'var(--accent)':v>30?'var(--blue)':'var(--green)';
    return `<div class="bar-col" style="min-width:0;">
      <div class="bar" style="height:${(v/maxH)*160}px;background:linear-gradient(to top,${color},${color}44);flex:1;">
        <span class="bar-val">${v}%</span>
      </div>
    </div>`;
  }).join('');

  labels.style.cssText='display:flex;gap:4px;margin-top:6px;';
  labels.innerHTML=hourly.map((_,i)=>
    `<div style="flex:1;font-family:var(--font-mono);font-size:7px;color:var(--muted);text-align:center;">${String(i).padStart(2,'0')}</div>`
  ).join('');

  // Peak hours list
  const peaks=[
    {time:'11:00–12:00',pct:94,color:'var(--red)'},{time:'10:00–11:00',pct:92,color:'var(--red)'},
    {time:'09:00–10:00',pct:85,color:'var(--accent)'},{time:'17:00–18:00',pct:86,color:'var(--accent)'},
    {time:'08:00–09:00',pct:72,color:'var(--blue)'},{time:'16:00–17:00',pct:78,color:'var(--blue)'},
    {time:'18:00–19:00',pct:74,color:'var(--blue)'},{time:'13:00–14:00',pct:80,color:'var(--accent)'},
  ];
  const pl=document.getElementById('peakList');
  if(pl) pl.innerHTML=peaks.map(p=>`
    <div class="peak-row">
      <div class="peak-time">${p.time}</div>
      <div class="peak-track"><div class="peak-fill" style="width:${p.pct}%;background:${p.color};"></div></div>
      <div class="peak-pct">${p.pct}%</div>
    </div>`).join('');
}

// ═══════════════════════════════════════════════════════════════
// HEATMAP
// ═══════════════════════════════════════════════════════════════
function renderHeatmap(){
  const container=document.getElementById('heatmap-container');
  if(!container||container.children.length>0) return;

  const maxRev=Math.max(...Object.values(heatSlots).map(s=>s.intensity));

  Object.entries(zones).forEach(([zoneName,slots])=>{
    const zoneEl=document.createElement('div');
    zoneEl.innerHTML=`<div class="heatmap-zone-label">// ${zoneName}</div>`;
    const row=document.createElement('div'); row.className='heatmap-row';

    slots.forEach(slot=>{
      const data=heatSlots[slot.id];
      const cell=document.createElement('div');
      cell.className='hmap-cell';

      // intensity-based color
      if(data.status==='free'){
        cell.className+=' free';
      } else {
        const ratio=data.intensity/maxRev;
        if(ratio<0.35) cell.className+=' low';
        else if(ratio<0.65) cell.className+=' medium';
        else cell.className+=' high';
      }

      cell.setAttribute('data-id', slot.id);
      cell.title=slot.id;

      cell.addEventListener('mouseenter', e=>showTooltip(e,data));
      cell.addEventListener('mousemove',  e=>moveTooltip(e));
      cell.addEventListener('mouseleave', hideTooltip);

      row.appendChild(cell);
    });

    zoneEl.appendChild(row);
    container.appendChild(zoneEl);
  });
}

const tooltip=document.getElementById('tooltip');
function showTooltip(e,data){
  document.getElementById('tt-id').textContent=data.id;
  document.getElementById('tt-plate').textContent=data.plate;
  document.getElementById('tt-dur').textContent=data.duration;
  document.getElementById('tt-rev').textContent=data.revenue;
  document.getElementById('tt-status').textContent=data.status.toUpperCase();
  tooltip.classList.add('show');
  moveTooltip(e);
}
function moveTooltip(e){
  let x=e.clientX+14, y=e.clientY-10;
  if(x+200>window.innerWidth) x=e.clientX-210;
  tooltip.style.left=x+'px'; tooltip.style.top=y+'px';
}
function hideTooltip(){ tooltip.classList.remove('show'); }

// ═══════════════════════════════════════════════════════════════
// REVENUE REPORTS
// ═══════════════════════════════════════════════════════════════
function applyReportFilters(){
  const zone=document.getElementById('rpt-zone').value;
  const pay=document.getElementById('rpt-pay').value;
  const st=document.getElementById('rpt-status').value;

  let filtered=[...bookings];
  if(zone!=='all') filtered=filtered.filter(b=>b.zone===zone);
  if(pay==='paid')   filtered=filtered.filter(b=>b.paid);
  if(pay==='unpaid') filtered=filtered.filter(b=>!b.paid);
  if(st!=='all') filtered=filtered.filter(b=>b.status===st);

  const totalRev=filtered.reduce((s,b)=>s+(b.paid?b.revenue:0),0);
  const avgRev=filtered.length?Math.round(totalRev/filtered.length):0;
  const avgDur=filtered.length?(filtered.reduce((s,b)=>s+b.duration,0)/filtered.length).toFixed(1):0;

  document.getElementById('rpt-total-rev').textContent=totalRev.toLocaleString();
  document.getElementById('rpt-total-bk').textContent=filtered.length;
  document.getElementById('rpt-avg-rev').textContent=avgRev;
  document.getElementById('rpt-avg-dur').textContent=avgDur;
  document.getElementById('rpt-record-count').textContent=`${filtered.length} RECORDS FOUND`;

  document.getElementById('report-tbody').innerHTML=filtered.map(b=>`
    <tr>
      <td><span style="font-family:var(--font-mono);font-size:12px;color:var(--muted)">${b.id}</span></td>
      <td>${b.name}</td>
      <td><span class="car-plate">${b.plate}</span></td>
      <td><span style="font-family:var(--font-mono);font-weight:600;color:var(--accent)">${b.slot}</span></td>
      <td><span class="badge badge-blue">ZONE ${b.zone}</span></td>
      <td><span class="time-text">${b.entry}</span></td>
      <td><span class="time-text">${b.exit||'—'}</span></td>
      <td><span style="font-family:var(--font-mono);font-size:12px;">${b.duration}h</span></td>
      <td><span style="font-family:var(--font-display);font-size:18px;color:var(--green)">${b.revenue} <span style="font-size:11px;color:var(--muted);">EGP</span></span></td>
      <td>${b.paid?'<span class="badge badge-green">✓ Paid</span>':'<span class="badge badge-red">✗ Unpaid</span>'}</td>
      <td>${statusBadge(b.status)}</td>
    </tr>`).join('');
}

function exportCSV(){
  const headers=['ID','Name','Plate','Slot','Zone','Entry','Exit','Duration','Revenue','Paid','Status'];
  const rows=bookings.map(b=>[b.id,b.name,b.plate,b.slot,'Zone '+b.zone,b.entry,b.exit||'',b.duration+'h',b.revenue+' EGP',b.paid?'Paid':'Unpaid',b.status]);
  const csv=[headers,...rows].map(r=>r.join(',')).join('\n');
  const a=document.createElement('a');
  a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download='ParkOS_Revenue_Report.csv';
  a.click();
}

// ═══════════════════════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════════════════════
renderSlots();
renderBookings();
renderBarChart();
</script>
</body>
</html>